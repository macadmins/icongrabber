# Release Workflow Architecture

## Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TRIGGER RELEASE                           â”‚
â”‚                                                                 â”‚
â”‚  Option 1: Push tag             Option 2: Manual trigger       â”‚
â”‚  git tag v1.0.0                 Actions â†’ Run workflow          â”‚
â”‚  git push origin v1.0.0         Enter version number            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BUILD PHASE                              â”‚
â”‚                                                                 â”‚
â”‚  1. Checkout code from repository                               â”‚
â”‚  2. Determine version number                                    â”‚
â”‚  3. Compile Swift binary with optimizations                     â”‚
â”‚  4. Strip debug symbols                                         â”‚
â”‚  5. Verify binary architecture                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SIGNING PHASE                              â”‚
â”‚                  (if secrets configured)                        â”‚
â”‚                                                                 â”‚
â”‚  1. Import P12 certificate to temporary keychain                â”‚
â”‚  2. Sign binary with Developer ID Application                   â”‚
â”‚     - Runtime hardening enabled                                 â”‚
â”‚     - Secure timestamp added                                    â”‚
â”‚  3. Verify code signature                                       â”‚
â”‚  4. Display signing details                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PACKAGE CREATION                             â”‚
â”‚                                                                 â”‚
â”‚  1. Create package directory structure:                         â”‚
â”‚     pkgroot/usr/local/bin/icongrabber                           â”‚
â”‚     pkgroot/usr/local/share/man/man1/icongrabber.1              â”‚
â”‚                                                                 â”‚
â”‚  2. Create postinstall script                                   â”‚
â”‚  3. Build component package                                     â”‚
â”‚  4. Create distribution XML                                     â”‚
â”‚  5. Build product archive (.pkg)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PKG SIGNING PHASE                            â”‚
â”‚                  (if secrets configured)                        â”‚
â”‚                                                                 â”‚
â”‚  1. Sign PKG with Developer ID Installer                        â”‚
â”‚  2. Add secure timestamp                                        â”‚
â”‚  3. Verify PKG signature                                        â”‚
â”‚  4. Display certificate chain                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NOTARIZATION PHASE                            â”‚
â”‚           (if Apple ID credentials configured)                  â”‚
â”‚                                                                 â”‚
â”‚  1. Submit PKG to Apple notarization service                    â”‚
â”‚  2. Wait for Apple to scan and approve (~2-5 min)               â”‚
â”‚  3. Staple notarization ticket to PKG                           â”‚
â”‚  4. Verify stapling successful                                  â”‚
â”‚                                                                 â”‚
â”‚  Result: PKG trusted by Gatekeeper worldwide                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DISTRIBUTION PREPARATION                        â”‚
â”‚                                                                 â”‚
â”‚  1. Create binary tarball:                                      â”‚
â”‚     - Copy binary                                               â”‚
â”‚     - Include README, LICENSE                                   â”‚
â”‚     - Compress as .tar.gz                                       â”‚
â”‚                                                                 â”‚
â”‚  2. Generate SHA-256 checksums                                  â”‚
â”‚  3. Create release notes                                        â”‚
â”‚     - Installation instructions                                 â”‚
â”‚     - Usage examples                                            â”‚
â”‚     - Changelog                                                 â”‚
â”‚     - Checksums                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GITHUB RELEASE                             â”‚
â”‚                                                                 â”‚
â”‚  Create release with:                                           â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“¦ icongrabber-1.0.0.pkg                                       â”‚
â”‚     - Signed with Developer ID                                  â”‚
â”‚     - Notarized by Apple                                        â”‚
â”‚     - Ready for distribution                                    â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“¦ icongrabber-1.0.0-macos-binary.tar.gz                       â”‚
â”‚     - For manual installation                                   â”‚
â”‚     - Includes documentation                                    â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“„ checksums.txt                                               â”‚
â”‚     - SHA-256 verification                                      â”‚
â”‚                                                                 â”‚
â”‚  Release notes with full instructions                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLEANUP                                 â”‚
â”‚                                                                 â”‚
â”‚  1. Delete temporary keychain                                   â”‚
â”‚  2. Remove build artifacts                                      â”‚
â”‚  3. Workflow complete âœ“                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GITHUB REPOSITORY                       â”‚
â”‚                                                              â”‚
â”‚  Source Code (Public)          Secrets (Encrypted)          â”‚
â”‚  â”œâ”€â”€ main.swift                â”œâ”€â”€ APPLE_CERTIFICATE_BASE64 â”‚
â”‚  â”œâ”€â”€ Makefile                  â”œâ”€â”€ APPLE_CERTIFICATE_PASSWORDâ”‚
â”‚  â””â”€â”€ workflows/release.yml     â”œâ”€â”€ APPLE_SIGNING_IDENTITY   â”‚
â”‚                                â”œâ”€â”€ APPLE_INSTALLER_SIGNING...â”‚
â”‚                                â”œâ”€â”€ APPLE_ID                  â”‚
â”‚                                â”œâ”€â”€ APPLE_TEAM_ID             â”‚
â”‚                                â””â”€â”€ APPLE_APP_PASSWORD        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                         â”‚
             â”‚                         â”‚ (Decrypted only in runner)
             â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GITHUB ACTIONS RUNNER (macOS)                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         TEMPORARY KEYCHAIN (Session only)              â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Developer ID Application Certificate        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  - Used to sign binary                       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  - Enables runtime hardening                 â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Developer ID Installer Certificate          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  - Used to sign PKG                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  - Verifies package integrity                â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  Auto-destroyed after workflow completes              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Communicates with:                                             â”‚
â”‚  - Apple Notary Service (notarization)                          â”‚
â”‚  - Apple Timestamp Server (secure timestamps)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Certificate Trust Chain

```
Apple Root CA
 â”‚
 â”œâ”€â”€ Apple Worldwide Developer Relations CA
 â”‚   â”‚
 â”‚   â”œâ”€â”€ Developer ID Application Certificate
 â”‚   â”‚   â””â”€â”€ Signs: icongrabber binary
 â”‚   â”‚
 â”‚   â””â”€â”€ Developer ID Installer Certificate
 â”‚       â””â”€â”€ Signs: icongrabber-1.0.0.pkg
 â”‚
 â””â”€â”€ Apple Notary Service
     â””â”€â”€ Validates & Notarizes: icongrabber-1.0.0.pkg
         â”‚
         â””â”€â”€ Stapled Ticket (embedded in PKG)

End User's Mac
 â”‚
 â”œâ”€â”€ Gatekeeper checks:
 â”‚   1. Valid signature from Developer ID
 â”‚   2. Notarization ticket present
 â”‚   3. Certificate not revoked
 â”‚   4. Code hasn't been tampered with
 â”‚
 â””â”€â”€ If all checks pass: Install without warnings âœ“
```

## Data Flow

```
Developer's Machine    GitHub Actions          End User's Mac
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚       â”‚            â”‚          â”‚              â”‚
â”‚  git tag     â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Workflow  â”‚          â”‚              â”‚
â”‚  v1.0.0      â”‚       â”‚  Triggered â”‚          â”‚              â”‚
â”‚              â”‚       â”‚            â”‚          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Build    â”‚
                       â”‚   Binary   â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚    Sign    â”‚
                       â”‚   Binary   â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Create   â”‚
                       â”‚    PKG     â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚    Sign    â”‚
                       â”‚    PKG     â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  Notarize  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    Apple     â”‚
                       â”‚    with    â”‚          â”‚   Notary     â”‚
                       â”‚   Apple    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Service    â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                   Approval
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Staple   â”‚
                       â”‚   Ticket   â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   GitHub   â”‚
                       â”‚   Release  â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Download
                             â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚   Download   â”‚
                                                â”‚     PKG      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  Gatekeeper  â”‚
                                                â”‚   Verifies   â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚   Install    â”‚
                                                â”‚   Success!   â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure After Release

```
GitHub Release Page
â”œâ”€â”€ icongrabber-1.0.0.pkg (signed & notarized)
â”‚   â””â”€â”€ Contains:
â”‚       â”œâ”€â”€ usr/local/bin/icongrabber (signed binary)
â”‚       â”œâ”€â”€ usr/local/share/man/man1/icongrabber.1
â”‚       â””â”€â”€ postinstall script
â”‚
â”œâ”€â”€ icongrabber-1.0.0-macos-binary.tar.gz
â”‚   â””â”€â”€ Contains:
â”‚       â”œâ”€â”€ icongrabber (signed binary)
â”‚       â”œâ”€â”€ README.md
â”‚       â””â”€â”€ LICENSE
â”‚
â””â”€â”€ checksums.txt
    â””â”€â”€ SHA-256 hashes for verification
```

## Conditional Execution Paths

```
Start Workflow
 â”‚
 â”œâ”€â”€â”€ Secrets Configured? â”€â”€â”€â”
 â”‚         YES                â”‚ NO
 â”‚          â”‚                 â”‚
 â”‚          â–¼                 â–¼
 â”‚    Sign Binary      Skip Signing
 â”‚          â”‚                 â”‚
 â”‚          â–¼                 â”‚
 â”‚      Sign PKG       Skip PKG Signing
 â”‚          â”‚                 â”‚
 â”‚          â–¼                 â”‚
 â”‚   Apple ID Set? â”€â”€â”€â”€â”      â”‚
 â”‚         YES   NO    â”‚      â”‚
 â”‚          â”‚     â”‚    â”‚      â”‚
 â”‚          â–¼     â”‚    â”‚      â”‚
 â”‚      Notarize  â”‚    â”‚      â”‚
 â”‚          â”‚     â”‚    â”‚      â”‚
 â”‚          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
 â”‚                â”‚           â”‚
 â”‚                â–¼           â–¼
 â”‚         Create Release (Signed & Notarized)
 â”‚
 â””â”€â”€ Create Release (Unsigned)
```

---

This architecture ensures:
- âœ“ Secure handling of certificates
- âœ“ No secrets in code
- âœ“ Works with or without signing
- âœ“ Full Apple compliance
- âœ“ Zero Gatekeeper issues for users

